# -*- mode: Python -*-

def flux_bootstrap(owner, name, path, git_token=None):
    """Bootstrap Flux for the specified repo owner/name

    Args:
        owner: The owner of the repo
        name: The name of the repo
        path: The path to use for bootstrap
        git_token (optional): Use this token for GitHub operations. If None it will
            use the value from the GITHIB_TOKEN environment variable. 
    
    """
    if not owner:
        fail("you must supply a repo owner in the tilt-settings")
    if not name:
        fail("you must supply a repo name")
    if not path:
        fail("you must supply a path")
    if not git_token:
        git_token = os.getenv("GITHUB_TOKEN", "")
    if git_token == "":
        fail("you must supply a GitHub token via the GITHUB_TOKEN environment variable or by parameter")

    cmd = "flux bootstrap --components=kustomize-controller,source-controller github --private=false --owner {repo_owner} --repository {repo_name} --personal --path={path}".format(
        repo_owner = owner,
        repo_name = name,
        path = path
    )
    local(cmd, env = {"GITHUB_TOKEN": git_token})